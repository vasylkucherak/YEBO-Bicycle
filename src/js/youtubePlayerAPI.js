const song = [
    {id: 0, name: {JP: "命に嫌われている", TL: "Inochi ni kirawarete iru", UA: "Ненависний життям"}, singerId: 0, time: "4:34", date: "7 серпня 2017 р.", rating: {music: 10, text: 10}, link: "eq8r1ZTma08", descr: "Продюсер цієї пісні - Kanzaki Iori ", text: {JP: "「死にたいなんて言うなよ<br>諦めないで生きろよ。」<br>そんな歌が正しいなんて<br>馬鹿げてるよな。<br><br>実際自分は死んでもよくて<br>周りが死んだら悲しくて<br>「それが嫌だから」っていう<br>エゴなんです。<br><br>他人が生きてもどうでもよくて<br>誰かを嫌うこともファッションで<br>それでも「平和に生きよう」なんて<br>素敵なことでしょう。<br><br>画面の先では誰かが死んで<br>それを嘆いて誰かが歌って<br>それに感化された少年が<br>ナイフを持って走った。<br><br>僕らは命に嫌われている。<br>価値観もエゴも押し付けて<br>いつも誰かを殺したい歌を<br>簡単に電波で流した。<br><br>僕らは命に嫌われている。<br>軽々しく死にたいだとか<br>軽々しく命を見てる<br>僕らは命に嫌われている。<br><br>お金がないので今日も<br>一日中惰眠を謳歌する<br>生きる意味なんて見出せず、<br>無駄を自覚して息をする。<br><br>寂しいなんて言葉で<br>この傷が表せていいものか<br>そんな意地ばかり抱え<br>今日も一人ベッドに眠る<br><br>少年だった僕たちは<br>いつか青年に変わっていく。<br>年老いていつか 枯れ葉のように<br>誰にも知られず朽ちていく。<br><br>不死身の身体を手に入れて、<br>一生死なずに生きていく。<br>そんなSFを妄想してる<br><br>自分が死んでもどうでもよくて<br>それでも周りに生きて欲しくて<br>矛盾を抱えて生きてくなんて<br>怒られてしまう。<br><br>「正しいものは正しくいなさい。」<br>「死にたくないなら生きていなさい。」<br>悲しくなるならそれでもいいなら<br>ずっと一人で笑えよ。<br><br>僕らは命に嫌われている。<br>幸福の意味すらわからず、<br>産まれた環境ばかり憎んで<br>簡単に過去ばかり呪う。<br><br>僕らは命に嫌われている。<br>さよならばかりが好きすぎて<br>本当の別れなど知らない<br>僕らは命に嫌われている<br><br>幸福も別れも<br>愛情も友情も<br>滑稽な夢の戯れで<br>全部カネで買える代物。<br><br>明日死んでしまうかもしれない。<br>すべて無駄になるかもしれない。<br>朝も夜も春も秋も<br>変わらず誰かがどこかで死ぬ。<br><br>夢も明日も何もいらない。<br>君が生きていたならそれでいい。<br>そうだ。本当は<br>そういうことが歌いたい。<br><br>命に嫌われている。<br>結局いつかは死んでいく。<br>君だって僕だっていつかは<br>枯れ葉のように朽ちてく。<br><br>それでも僕らは必死に生きて<br>命を必死に抱えて生きて<br>殺してあがいて笑って抱えて<br>生きて、生きて、生きて、生きて、生きろ。", TL: "«shinitai nante iu na yo.<br>akiramenaide ikiro yo.»<br>sonna uta ga tadashii nante<br>bakageteru yo na.<br><br>jissai jibun wa shinde mo yokute<br>mawari ga shindara kanashikute<br>«sore ga iya dakara» tte iu<br>ego nan desu.<br><br>tanin ga ikite mo dou demo yokute<br>dareka o kirau koto mo fasshon de<br>soredemo «heiwa ni ikiyou» nante<br>suteki na koto deshou.<br><br>gamen no saki de wa dareka ga shinde<br>sore o nageite dareka ga utatte<br>sore ni kanka sareta shounen ga<br>naifu o motte hashitta.<br><br>bokura wa inochi ni kirawarete iru.<br>kachikan mo ego mo oshitsukete<br>itsumo dareka o koroshitai uta o<br>kantan ni denpa de nagashita.<br><br>bokura wa inochi ni kirawarete iru.<br>karugarushiku shinitai datoka<br>karugarushiku inochi o miteru<br>bokura wa inochi ni kirawarete iru.<br><br>okane ga nai node kyou mo<br>ichinichijuu damin o ouka suru<br>ikiru imi nante midasezu<br>muda o jikaku shite iki o suru.<br><br>sabishii nante kotoba de<br>kono kizu ga arawasete ii mono ka<br>sonna iji bakari kakae<br>kyou mo hitori beddo ni nemuru<br><br>shounen datta bokutachi wa<br>itsuka seinen ni kawatte iku.<br>toshioite itsuka kareha no you ni<br>dare ni mo shirarezu kuchite iku.<br><br>fujimi no karada o te ni irete,<br>isshou shinazu ni ikite iku.<br>sonna SF o mousou shiteru<br><br>jibun ga shinde mo dou demo yokute<br>soredemo mawari ni ikite hoshikute<br>mujun o kakaete ikiteku nante<br>okorarete shimau.<br><br>«tadashii mono wa tadashiku inasai.»<br>«shinitakunai nara ikite inasai.»<br>kanashiku naru nara soredemo ii nara<br>zutto hitori de warae yo.<br><br>bokura wa inochi ni kirawarete iru.<br>koufuku no imi sura wakarazu,<br>umareta kankyou bakari nikunde<br>kantan ni kako bakari norou.<br><br>bokura wa inochi ni kirawarete iru.<br>sayonara bakari ga sukisugite<br>hontou no wakare nado shiranai<br>bokura wa inochi ni kirawarete iru.<br><br>koufuku mo wakare mo<br>aijou mo yuujou mo<br>kokkei na yume no tawamure de<br>zenbu kane de kaeru shiromono.<br><br>ashita shinde shimau kamo shirenai.<br>subete muda ni naru kamo shirenai.<br>asa mo yoru mo haru mo aki mo<br>kawarazu dareka ga dokoka de shinu.<br><br>yume mo asu mo nani mo iranai.<br>kimi ga ikite ita nara sore de ii.<br>sou da. hontou wa<br>sou iu koto ga utaitai.<br><br>inochi ni kirawarete iru.<br>kekkyoku itsuka wa shinde iku.<br>kimi datte boku datte itsuka wa<br>kareha no you ni kuchiteku.<br><br>soredemo bokura wa hisshi ni ikite<br>inochi o hisshi ni kakaete ikite<br>koroshite agaite waratte kakaete<br>ikite, ikite, ikite, ikite, ikiro.", UA: "«Смерті собі краще не бажай».<br>«Не здавайся жити» - у думках тримай<br>...абсурдно про таке співати<br>і вважати правильним<br><br>Чесно, байдуже мені якщо я помру,<br>Та якщо помре хтось інший - не переживу<br>Одразу говорить мені его -<br>«Я цього не хочу»<br><br>Справи чужих людей є байдужі мені<br>Ненавидіти усіх - ось мода наших днів<br>Та хіба не краще просто жити мирно<br>Це ж чудово, хіба ні?<br><br>По той бік екрану хтось знову помирає<br>І по цьому зразу інший пісню заспіває<br>Слідкуючи за цим, молодий хлопець<br>Зразу береться за ніж свій<br><br>Це життя кожен раз так ненавидить нас<br>Забиваючи на цінності та мораль,<br>і як завжди, будуть говорити<br>про бажання ще когось убити<br><br>Це життя кожен раз так ненавидить нас<br>Що бездумно не фільтруємо сказаних фраз<br>і як завжди не цінуємо ми зараз<br>Це життя, що кожен раз так ненавидить нас<br><br>Кошильок порожний, сьогодні знов<br>На ввесь день я обмежусь одним тільки сном<br>Наодинці ідучи назустріч міражу<br>зразу розумію, що даремно живу<br><br>смутне самотності відчуття<br>Ось яка найболючіша рана моя<br>будучи впертим сьогодні<br>знову сплю я в лішку на самоті"}},
    {id: 1, name: {JP: "Transient Blue", TL: "", UA: "Перехідний блакитний"}, singerId: 1, time: "4:21", date: "27 лютого 2015 р.", rating: {music: 8, text: 7}, link: "RzQXWh4yl78", descr: "", text: {JP: "", TL: "", UA: ""}},
    {id: 2, name: {JP: "ないない", TL: "Nai Nai", UA: "Ні-ні"}, singerId: 2, time: "4:11", date: "12 травня 2021 р", rating: {music: 9, text: 8}, link: "M8LwhRkNaSQ", descr: "Дана пісня стала ендінгом до аніме «Дім тіней»", text: {JP: "", TL: "", UA: ""}},
    {id: 3, name: {JP: "平行線", TL: "Heikousen", UA: "Паралельні прямі"}, singerId: 3, time: "4:59", date: "17 травня 2017 р.", rating: {music: 10, text: 10}, link: "kKOkybfh9bE", descr: "Дана пісня стала ендінгом до аніме «Таємні бажання відкинутих»", text: {JP: "", TL: "", UA: ""}},
    {id: 4, name: {JP: "聞こえますか", TL: "Kikoemasuka", UA: "Ви мене чуєте"}, singerId: 4, time: "3:41", date: "15 січня 2020 р.", rating: {music: 10, text: 10}, link: "jkZY2vAYbmE", descr: "", text: {JP: "", TL: "", UA: ""}},
    //{id: 10, name: {JP: "", TL: "", UA: ""}, singerId: , time: "", date: "", rating: {music: 0, text: 0}, link: "", descr: "", text: {JP: "", TL: "", UA: ""}},
];

const singer = [
    {id: 0, name: {JP: 'まふまふ', TL: 'Mafu-mafu', UA: 'Мафу-мафу'}, sex: 'female', birth: {date: '', place: ''}, height: 1, zodiac: '', blood: '', rating: {voice: 0, beauty: 0}, img: '', gif: [], social: {}, descr: ''},
    {id: 1, name: {JP: 'ちょうちょ', TL: 'ChouCho', UA: 'Метелик'}, sex: 'female', birth: {date: '', place: ''}, height: 1, zodiac: '', blood: '', rating: {voice: 0, beauty: 0}, img: '', gif: [], social: {}, descr: ''},
    {id: 2, name: {JP: "ReoNa", TL: "", UA: "РеоНа"}, sex: 'female', birth: {date: '', place: ''}, height: 1, zodiac: '', blood: '', rating: {voice: 0, beauty: 0}, img: '', gif: [], social: {}, descr: ''},
    {id: 3, name: {JP: "さユり", TL: "Sayuri", UA: "Саюрі"}, sex: 'female', birth: {date: '', place: ''}, height: 1, zodiac: '', blood: '', rating: {voice: 0, beauty: 0}, img: '', gif: [], social: {}, descr: ''},
    {id: 4, name: {JP: "HoneyWorks", TL: "", UA: "HoneyWorks"}, sex: '', birth: {date: '', place: ''}, height: 1, zodiac: '', blood: '', rating: {voice: 0, beauty: 0}, img: '', gif: [], social: {}, descr: ''},
    //{id: 5, name: {JP: '', TL: '', UA: ''}, sex: '', birth: {date: '', place: ''}, height: 1, zodiac: '', blood: '', rating: {voice: 0, beauty: 0}, img: '', gif: [], social: {}, descr: ''},
];

const playerWrapper = document.querySelector('.player'),
        playerList = playerWrapper.querySelector('.player__list'),
          playerListItems = playerList.querySelector('.player__list-items'),
        playerContent = playerWrapper.querySelector('.player__content'),
          playerShield = playerContent.querySelector('.player__content-shield'),
        playerStarter = playerWrapper.querySelector('.player__starter'),
        playerDescr = playerWrapper.querySelector('.player__info-descr'),
        playerControls = playerWrapper.querySelector('.player__info-controls'),
            playerListBtn = playerControls.querySelector('.list-btn'),
            playerPrevBtn = playerControls.querySelector('.prev-btn'),
            playerPlayBtn = playerWrapper.querySelector('.play-btn'),
            playerPauseBtn = playerWrapper.querySelector('.pause-btn'),
            playerNextBtn = playerWrapper.querySelector('.next-btn'),
            playerCollapseBtn = playerWrapper.querySelector('.collapse-btn');


let songListId = [];

renderSongList();

const items = document.querySelectorAll('.player__list-item');
items[0].click();
let currentSongCounter = 0;

selectSong();

playerStarter.addEventListener('click', () => {
    playerWrapper.classList.add('active');
    playerStarter.disabled = true;
    playerCollapseBtn.disabled = true;
    playerListBtn.disabled = true;
    playerNextBtn.disabled = true;
    playerPrevBtn.disabled = true;
    playerPlayBtn.disabled = true;
    playerPauseBtn.disabled = true;

    setTimeout(function() {
        playerDescr.classList.add('show');
        playerCollapseBtn.disabled = false;
        playerListBtn.disabled = false;
        playerNextBtn.disabled = false;
        playerPrevBtn.disabled = false;
        playerPlayBtn.disabled = false;
        playerPauseBtn.disabled = false;
    }, 1000);
});

playerCollapseBtn.addEventListener('click', () => {
    if (playerList.classList.contains('active')) {    
        playerListBtn.click();
        setTimeout(function() {
            playerCollapseBtn.click();
        }, 1000);
    } else {
        playerWrapper.classList.remove('active');
        playerDescr.classList.remove('show');
        playerCollapseBtn.disabled = true;
        setTimeout(function() {
            playerStarter.disabled = false;
        }, 1000);
    }
});

playerListBtn.addEventListener('click', () => {
    playerList.classList.toggle('active');
    if (playerList.classList.contains('active')) {
        playerList.style.width = '300px';
    }
    playerListBtn.disabled = true;
    setTimeout(function() {
        if (!playerList.classList.contains('active')) {
            playerList.style.width = '80px';
        }
        playerListBtn.disabled = false;
    }, 1000);
});

playerNextBtn.addEventListener('click', () => {
    playerNextBtn.disabled = true;
    if (currentSongCounter == Object.keys(songListId).length - 1) {
        currentSongCounter = 0;
    } else {
        currentSongCounter++;
    }
    playThisSong(songListId[currentSongCounter]);
    items.forEach(i => {
        i.classList.remove('active');
    });
    items[currentSongCounter].classList.add('active');
    setTimeout(function() {
        playerNextBtn.disabled = false;
    }, 700);
});

playerPrevBtn.addEventListener('click', () => {
    playerPrevBtn.disabled = true;
    if (currentSongCounter == 0) {
        currentSongCounter = Object.keys(songListId).length - 1;
    } else {
        currentSongCounter--;
    }
    playThisSong(songListId[currentSongCounter]);
    items.forEach(i => {
        i.classList.remove('active');
    });
    items[currentSongCounter].classList.add('active');
    setTimeout(function() {
        playerPrevBtn.disabled = false;
    }, 700);
});

playerPlayBtn.addEventListener('click', () => {
    playerPauseBtn.disabled = true;
    playerPlayBtn.classList.add('hidden');
    playerPauseBtn.classList.remove('hidden');
    setTimeout(function() {
        playerPauseBtn.disabled = false;
    }, 50);
});

playerPauseBtn.addEventListener('click', () => {
    playerPlayBtn.disabled = true;
    playerPauseBtn.classList.add('hidden');
    playerPlayBtn.classList.remove('hidden');
    setTimeout(function() {
        playerPlayBtn.disabled = false;
    }, 50);
});

let firstPlay = true;

var tag = document.createElement('script');

tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);


function onYouTubeIframeAPIReady() {
    playThisSong(songListId[currentSongCounter]);
}

function onPlayerReady(event) {
    if (firstPlay) {
        playerStarter.addEventListener('click', () => {
            event.target.playVideo();
            playerShield.classList.remove('active');
            playThisSong(songListId[currentSongCounter]);
            items[currentSongCounter].classList.add('active');
            firstPlay = false;
        });
    } else {
        if (playerPlayBtn.classList.contains('hidden')) {
            event.target.playVideo();
        }
    }  
}

function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.PLAYING) {
        playerPauseBtn.addEventListener('click', () => {
            playerShield.classList.add('active');
            player.pauseVideo();
        });
    }
    if (event.data == YT.PlayerState.PAUSED) {
        playerPlayBtn.addEventListener('click', () => {
            player.playVideo();   
            setTimeout(function() {
                playerShield.classList.remove('active');
            }, 500);
        });
    }
    if (event.data == YT.PlayerState.ENDED) {
        playerNextBtn.click();
    }
}

var player;
function playThisSong(songId) {
    if (player) {
        player.destroy();
    }
    player = new YT.Player('player', {
        height: '360',
        width: '640',
        videoId: song[songId].link,
        playerVars: { 'controls': 0, 'playsinline': 1, 'iv_load_policy': 3, 'modestbranding': 1, 'rel': 0, 'showinfo': 0},
        events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
        }
    });
    playerDescr.innerHTML = `
        <div class="descr-jp">${singer[songId].name.JP} - ${song[songId].name.JP}</div>
        <div class="descr-ua">${singer[songId].name.UA} - ${song[songId].name.UA} </div>
    `;
    playerShield.style.background = `url('https://img.youtube.com/vi/${song[songId].link}/hqdefault.jpg') no-repeat 50% / cover`;
}

function renderSongList() {
    let containText;
    song.forEach((mus, i) => {
        if (mus.text.JP == '') {
            containText = '';
        } else {
            containText = '<div class="descr-text">&#9998;</div>';
        }
        const songCard = document.createElement('div');
        songCard.innerHTML = `
            <button class="player__list-item" data-id=${mus.id}>
                <img src="https://img.youtube.com/vi/${mus.link}/hqdefault.jpg" alt="music-img">
                <div class="descr">
                    <div class="descr-name">${mus.name.JP}</div>
                    <div class="descr-singer">${singer[mus.singerId].name.JP}</div>
                    <div class="descr-number">
                        <div class="descr-number-time">&#8986; ${mus.time}</div>
                        <div class="descr-number-rating">${(mus.rating.music+mus.rating.text)/2} <span>&#9733;</span></div>
                    </div>
                    ${containText}
                </div>
            </button>
        `
        playerListItems.append(songCard);
        songListId.push(mus.id);
    });
}

function selectSong() {
    items.forEach(item => {
        item.addEventListener('click', () => {
            items.forEach(i => {
                i.classList.remove('active');
            });
            songListId.forEach((id, i) => {
                if (songListId[id] == item.dataset.id) {
                    currentSongCounter = i;
                }
            });
            playThisSong(songListId[currentSongCounter]);
            item.classList.add('active');
        });
    });
}